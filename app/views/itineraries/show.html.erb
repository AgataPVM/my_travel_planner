<div class="container my-4">
  <div class="card shadow-sm border-dark rounded-4 mb-3 bg-white">
    <div class="card-body p-4">
      <h1 class="card-title mb-4 text-primary fw-bold"><%= @itinerary.title %></h1>

      <p class="mb-2"><strong>Destino:</strong> <%= @itinerary.destination %></p>
      <p class="mb-2"><strong>Número de pessoas:</strong> <%= @itinerary.people %></p>
      <p class="mb-2"><strong>Número de dias:</strong> <%= @itinerary.days %></p>
      <p class="mb-2"><strong>Interesses:</strong> <%= @itinerary.interest %></p>
    </div>
  </div>

  <div id="itinerary_content" class="card shadow-sm border-dark rounded-4 mb-4 bg-white">
    <div class="card-body p-4">
      <h2 class="card-title mb-4 text-primary fw-bold">Itinerário:</h2>

      <div class="generated-content fs-6 text-dark lh-base">
        <%= raw(render_markdown(@itinerary.content)) %>
      </div>

      <div class="mt-3 d-flex gap-2">
        <%= link_to "Remover", itinerary_path(@itinerary),
            data: { turbo_method: :delete, turbo_confirm: "Tem certeza?" },
            class: "btn btn-dark" %>
        <%= link_to "Voltar", itineraries_path, class: "btn btn-primary" %>
      </div>
    </div>
  </div>

  <div class="mb-3">
  <h3 class="card-title my-3 text-primary fw-bold">Pergunte ao assistente</h3>

  <div id="messages" class="d-flex flex-column gap-2">
    <% @itinerary.messages.order(:created_at).each_slice(2) do |pair| %>
      <div class="turn">
        <% pair.each do |message| %>
          <% if message.role == "user" %>
            <div class="d-flex justify-content-end">
              <div class="d-inline-block bg-light border border-dark rounded-pill px-3 py-2 text-dark text-break">
                <%= raw(render_markdown(message.content)) %>
              </div>
            </div>
          <% else %>
            <div class="my-1">
              <div class="card border-dark bg-white rounded-4 w-100">
                <div class="card-body p-3 text-dark text-break">
                  <%= raw(render_markdown(message.content)) %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
  <div id="new_message">
  <%= simple_form_for [@itinerary, @message],
        html: { data: { turbo_preserve_scroll: true } } do |f| %>

  <div class="card shadow-sm border-dark rounded-4 mb-2 bg-white">
    <div class="card-body p-3">
      <%= f.input :content, label: false,
           input_html: {
            rows: 3,
            placeholder: "Peça ajustes no roteiro ou faça uma pergunta..."
            } %>
    </div>
  </div>

  <div class="mt-2 d-flex justify-content-end">
      <%= f.button :submit, "Enviar", class: "btn btn-primary btn-sm" %>
    </div>
  <% end %>

</div>
